<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="description" content="WSGI（Web Server Gateway Interface, Web 服务器网关接口）是描述 Web 服务器如何与 Web 应用程序通信以及如何将 Web 应用程序链接在一起以处理一个 Request 的规范。 只有 Web 服务器和编程框架的作者才需要了解 WSGI 设计的每个细节和特殊情况。您无需了解 WSGI 的每个细节，仅安装 WSGI 应用程序或使用现有框架编写 Web 应用程序">
<meta property="og:type" content="article">
<meta property="og:title" content="wsgiref">
<meta property="og:url" content="https://xinetzone.github.io/post/zh-CN/22add8d782c9.html">
<meta property="og:site_name" content="上善若水">
<meta property="og:description" content="WSGI（Web Server Gateway Interface, Web 服务器网关接口）是描述 Web 服务器如何与 Web 应用程序通信以及如何将 Web 应用程序链接在一起以处理一个 Request 的规范。 只有 Web 服务器和编程框架的作者才需要了解 WSGI 设计的每个细节和特殊情况。您无需了解 WSGI 的每个细节，仅安装 WSGI 应用程序或使用现有框架编写 Web 应用程序">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-08T06:07:37.000Z">
<meta property="article:modified_time" content="2021-03-08T06:07:37.000Z">
<meta property="article:author" content="xinetzone">
<meta property="article:tag" content="WSGI">
<meta name="twitter:card" content="summary">
    <link rel="shortcut icon" href="/dao/favicon.png">
    
    <title>wsgiref | 上善若水</title>
    
    
<link rel="stylesheet" href="https://xinetzone.github.io/w3css/4/w3.css">

    
<link rel="stylesheet" href="https://xinetzone.github.io/xinet-css/tabs.css">


    <link rel="stylesheet" type="text/css" href="https://xinetzone.github.io/Font-Awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/dao/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/dao/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/dao/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/dao/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/dao/css/xin-prism.css">
    <link rel="stylesheet" type="text/css" href="/dao/css/my.css">
    <script src="/dao/libs/jquery/jquery.min.js"></script>
<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/dao/rss2.xml" title="上善若水" type="application/rss+xml">
</head>



<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/dao/" class="waves-effect waves-light">
                    
                    <img src="/dao/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">上善若水</span>
                </a>
            </div>
            <a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/dao/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/dao/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/dao/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/dao/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <span class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
      </span>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/dao/tags">
          
          <i class="fas fa-tags" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>标签</span>
        </a>
      </li>
      
      <li>
        <a href="/dao/categories">
          
          <i class="fas fa-bookmark" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>分类</span>
        </a>
      </li>
      
      <li>
        <a href="/dao/archives">
          
          <i class="far fa-calendar-alt" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>时间线</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <span class="waves-effect waves-light">
      
      <i class="fas fa-comment-alt" style="zoom: 0.6;"></i>
      
      <span>话题</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
      </span>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/dao/topics">
          
          <i class="fas fa-comment" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>话题</span>
        </a>
      </li>
      
      <li>
        <a href="/dao/python">
          
          <i class="fas fa-tools" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Python</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <span class="waves-effect waves-light">
      
      <i class="fas fa-list" style="zoom: 0.6;"></i>
      
      <span>混沌</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
      </span>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/dao/chaos">
          
          <i class="fas fa-atom" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>太极</span>
        </a>
      </li>
      
      <li>
        <a href="/dao/books">
          
          <i class="fas fa-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>资源库</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">
    <div class="mobile-head bg-color">
        
        <img src="/dao/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">上善若水</div>
        <div class="logo-desc">
            
            利用 AI 开发一切有意思的东西
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/dao/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/dao/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/dao/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/dao/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-archive"></i>
			
			归档
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
    <ul  style="background:  ;" >
      
        <li>
          <a href="/dao/tags " style="margin-left: 75px">
				  
            <i class="fa fas fa-tags" style="position: absolute;left:50px" ></i>
			      
            <span>标签</span>
                  </a>
                </li>
              
        <li>
          <a href="/dao/categories " style="margin-left: 75px">
				  
            <i class="fa fas fa-bookmark" style="position: absolute;left:50px" ></i>
			      
            <span>分类</span>
                  </a>
                </li>
              
        <li>
          <a href="/dao/archives " style="margin-left: 75px">
				  
            <i class="fa far fa-calendar-alt" style="position: absolute;left:50px" ></i>
			      
            <span>时间线</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-comment-alt"></i>
			
			话题
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
    <ul  style="background:  ;" >
      
        <li>
          <a href="/dao/topics " style="margin-left: 75px">
				  
            <i class="fa fas fa-comment" style="position: absolute;left:50px" ></i>
			      
            <span>话题</span>
                  </a>
                </li>
              
        <li>
          <a href="/dao/python " style="margin-left: 75px">
				  
            <i class="fa fas fa-tools" style="position: absolute;left:50px" ></i>
			      
            <span>Python</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-list"></i>
			
			混沌
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
    <ul  style="background:  ;" >
      
        <li>
          <a href="/dao/chaos " style="margin-left: 75px">
				  
            <i class="fa fas fa-atom" style="position: absolute;left:50px" ></i>
			      
            <span>太极</span>
                  </a>
                </li>
              
        <li>
          <a href="/dao/books " style="margin-left: 75px">
				  
            <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
            <span>资源库</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/xinetzone/design" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/xinetzone/design" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    


<div class="bg-cover pd-header post-cover" style="background-image: url('/dao/medias/featureimages/5.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">wsgiref</h1>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">
    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
    <div class="row tag-cate">
        <div class="col s7">
            
            <div class="article-tag">
                
                    <a href="/dao/tags/WSGI/">
                        <span class="chip bg-color">WSGI</span>
                    </a>
                
            </div>
            
        </div>
        <div class="col s5 right-align">
            
            <div class="post-cate">
                <i class="fas fa-bookmark fa-fw icon-category"></i>
                
                    <a href="/dao/categories/%E6%89%8B%E5%86%8C/" class="post-category">
                        手册
                    </a>
                
            </div>
            
        </div>
    </div>

    <div class="post-info">
        
        <div class="post-date info-break-policy">
            <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
            2021-03-08
        </div>
        

        
        <div class="post-date info-break-policy">
            <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
            2021-03-08
        </div>
        

        
        <div class="info-break-policy">
            <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
            5.7k
        </div>
        

        
        <div class="info-break-policy">
            <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
            23 分
        </div>
        

        
            <div id="busuanzi_container_page_pv" class="info-break-policy">
                <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                <span id="busuanzi_value_page_pv"></span>
            </div>
        
    </div>
</div>
<hr class="clearfix">
        
    <!-- 是否加载使用自带的 prismjs. -->
    <link rel="stylesheet" href="/dao/libs/prism/prism.css">
    

    

<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/dao/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/dao/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/dao/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/dao/libs/codeBlock/codeShrink.js"></script>



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
      integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script type="module">
    import renderMathInElement from "https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.mjs";
    let options = {
        delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "$", right: "$", display: false },
            { left: "\\(", right: "\\)", display: false },
            { left: "\\[", right: "\\]", display: true }
        ],
        leqno: true
    }
    renderMathInElement(document.querySelector("body"), options)
</script>

        <div class="card-content article-card-content">
    <div id="articleContent">
        <p>WSGI（Web Server Gateway Interface, Web 服务器网关接口）是描述 Web 服务器如何与 Web 应用程序通信以及如何将 Web 应用程序链接在一起以处理一个 Request 的规范。</p>
<p>只有 Web 服务器和编程框架的作者才需要了解 WSGI 设计的每个细节和特殊情况。您无需了解 WSGI 的每个细节，仅安装 WSGI 应用程序或使用现有框架编写 Web 应用程序即可。</p>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.10/library/wsgiref.html#module-wsgiref">wsgiref</a> 是 WSGI 规范的参考实现，可用于将 WSGI 支持添加到 Web 服务器或框架。它提供了用于处理 WSGI 环境变量和响应标头的实用程序，用于实现 WSGI 服务器的基类，为 WSGI 应用程序提供服务的演示 HTTP 服务器以及用于检查 WSGI 服务器和应用程序是否符合 WSGI 规范的验证工具（<a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-3333">PEP 3333</a>）。</p>
<p>有关 WSGI 的更多信息，请参见 <a target="_blank" rel="noopener" href="https://wsgi.readthedocs.io/">wsgi.readthedocs.io</a>，以及教程和其他资源的链接。</p>
<p>Python 目前拥有大量的 Web 框架，比如 Zope, Quixote, Webware, SkunkWeb, PSO, 和 Twisted Web。大量的选择使得新手无所适从，因为总得来说，框架的选择都会限制 Web 服务器的选择。</p>
<p>WSGI 的目的是使得 Web 框架和 Web 服务器之间轻松互连，而不是创建一套新的 Web 框架。</p>
<h2 id="PEP3333-概述"><a href="#PEP3333-概述" class="headerlink" title="PEP3333 概述"></a>PEP3333 概述</h2><p>WSGI 不是服务器，Python 模块，框架，API 或任何类型的软件。它只是服务器和应用程序进行通信的接口规范。在 PEP 3333 中指定了服务器和应用程序接口端。如果将应用程序（或框架或工具包）写入 WSGI 规范，则它将在写入该规范的任何服务器上运行。</p>
<p>可以堆叠 WSGI 应用程序（意味着符合 WSGI）。那些位于堆栈中间的组件称为<strong>中间件</strong>（middleware，一般为 app 的 Python 装饰器），它们必须同时实现 WSGI 接口的两端：应用程序和服务器。对于最上面的应用程序，它将充当服务器，对于下面的应用程序，则它将充当应用程序。</p>
<p>WSGI 服务器（意味着符合 WSGI）仅接收来自客户端的请求，将其传递给应用程序，然后将应用程序返回的响应发送给客户端。它什么也没做。所有 gory 详细信息必须由应用程序或中间件提供。</p>
<p>无需学习 WSGI 规范即可在框架或工具包之上构建应用程序。要使用中间件，除非对中间件已经集成在框架中，或者框架提供了某种包装器以将那些未集成的中间件集成在一起，否则必须对如何将它们与应用程序或框架堆叠在一起有最低限度的了解。</p>
<h2 id="wsgiref-util-–-WSGI-environment-utilities"><a href="#wsgiref-util-–-WSGI-environment-utilities" class="headerlink" title="wsgiref.util – WSGI environment utilities"></a><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.10/library/wsgiref.html#module-wsgiref.util">wsgiref.util</a> – WSGI environment utilities</h2><p>如果要在单个主机和端口上提供多个应用程序，则应创建一个 WSGI 应用程序，该应用程序解析 <code>PATH_INFO</code> 以选择为每个请求调用哪个应用程序。（例如，使用 <code>wsgiref.util</code> 中的 <code>shift_path_info</code> 函数。）</p>
<p>该模块提供了用于 WSGI 环境的各种实用程序函数。WSGI 环境是一个包含 HTTP 请求变量的字典，如 <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-3333">PEP 3333</a> 中所述。所有带有 <code>environ</code> 参数的函数都希望提供符合 WSGI 的字典；请参阅 PEP 3333 了解详细规格。</p>
<ul>
<li><code>wsgiref.util.guess_scheme(environ)</code>：通过检查 <code>environ</code> 字典中的 <code>HTTPS</code> 环境变量，返回有关 <code>wsgi.url_scheme</code> 应为 <code>"http"</code> 还是 <code>"https"</code> 的猜测。返回值是字符串。当创建包装 CGI 或类似 CGI 的协议（如 FastCGI）的网关时，此功能很有用。通常，当通过 SSL 接收到请求时，提供此类协议的服务器将包含一个 <code>HTTPS</code> 变量，其值为 <code>"1"</code>, <code>"yes"</code>, 或者 <code>"on"</code>。因此，如果找到该值，此函数将返回 <code>"https"</code>，否则返回 <code>"http"</code>。</li>
<li><code>wsgiref.util.application_uri(environ)</code>：返回应用程序的基本 URI（无 <code>PATH_INFO</code> 或 <code>QUERY_STRING</code>）</li>
<li><code>wsgiref.util.request_uri(environ, include_query=True)</code>：使用 PEP 3333 的 “URL Reconstruction” 部分中找到的算法，返回完整的请求 URI（可选包括查询字符串）。如果 <code>include_query</code> 为 <code>false</code>，则查询字符串不包含在结果 URI 中。</li>
<li><code>wsgiref.util.shift_path_info(environ)</code>：将单个名称从 <code>PATH_INFO</code> 移至 <code>SCRIPT_NAME</code>，然后返回该名称。<code>environ</code> 字典就地修改；如果您需要保留原始的 <code>PATH_INFO</code> 或 <code>SCRIPT_NAME</code>，请使用 <code>copy</code>。如果 <code>PATH_INFO</code> 中没有剩余的路径段，则返回 <code>None</code>。通常，此例程（routine）用于处理请求 URI 路径的每个部分，例如，将该路径视为一系列字典键。该例程修改了传入的环境，使其适合于调用位于目标 URI 处的另一个 WSGI 应用程序。例如，如果在 <code>/foo</code> 处有一个 WSGI 应用程序，并且请求 URI 路径是 <code>/foo/bar/baz</code>，在 <code>/foo</code> 处的 WSGI 应用程序调用 <code>shift_path_info</code> 函数，它将接收字符串 “bar”，并且环境将被更新以适合传递到 <code>/foo/bar/</code> 的 WSGI 应用程序。也就是说，<code>SCRIPT_NAME</code> 将从 <code>/foo</code> 更改为 <code>/foo/bar/</code>，<code>PATH_INFO</code> 将从 <code>/bar/baz</code> 更改为 <code>/baz</code>。当 <code>PATH_INFO</code> 只是 <code>"/"</code> 时，此例程将返回一个空字符串，并在 <code>SCRIPT_NAME</code> 后面附加一个斜杠，即使通常忽略空路径段，并且 <code>SCRIPT_NAME</code> 通常也不以斜杠结尾。这是故意的行为，以确保应用程序在使用此例程进行对象遍历时可以区分以 <code>/x</code> 结尾的 URI 与以 <code>/x/</code> 结尾的 URI 之间的区别。</li>
<li><code>wsgiref.util.setup_testing_defaults(environ)</code>：为了测试目的，使用简单的默认值更新环境。此例程添加了 WSGI 所需的各种参数，包括 <code>HTTP_HOST</code>，<code>SERVER_NAME</code>，<code>SERVER_PORT</code>，<code>REQUEST_METHOD</code>，<code>SCRIPT_NAME</code>，<code>PATH_INFO</code> 以及所有 PEP 3333 定义的 <code>wsgi.*</code> 变量。它仅提供默认值，并且不替换这些变量的任何现有设置。该例程旨在使 WSGI 服务器和应用程序的单元测试更容易设置虚拟环境。实际的 WSGI 服务器或应用程序都不应使用它，因为数据是伪造的！</li>
</ul>
<p>用法示例：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> wsgiref<span class="token punctuation">.</span>util <span class="token keyword">import</span> setup_testing_defaults
<span class="token keyword">from</span> wsgiref<span class="token punctuation">.</span>simple_server <span class="token keyword">import</span> make_server

<span class="token comment"># A relatively simple WSGI application. It's going to print out the</span>
<span class="token comment"># environment dictionary after being updated by setup_testing_defaults</span>


<span class="token keyword">def</span> <span class="token function">simple_app</span><span class="token punctuation">(</span>environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    setup_testing_defaults<span class="token punctuation">(</span>environ<span class="token punctuation">)</span>

    status <span class="token operator">=</span> <span class="token string">'200 OK'</span>
    headers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    start_response<span class="token punctuation">(</span>status<span class="token punctuation">,</span> headers<span class="token punctuation">)</span>

    ret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>key<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
           <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> environ<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> ret


<span class="token keyword">with</span> make_server<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">,</span> simple_app<span class="token punctuation">)</span> <span class="token keyword">as</span> httpd<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Serving on port 8000..."</span><span class="token punctuation">)</span>
    httpd<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>wsgiref.util.is_hop_by_hop(header_name)</code>：如果 <code>'header_name'</code> 是 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc2616.html">RFC 2616</a> 定义的 HTTP/1.1 “Hop-by-Hop” Header，则返回 <code>True</code>。</li>
<li><code>class wsgiref.util.FileWrapper(filelike, blksize=8192)</code>：用于将类似文件的对象转换为迭代器的包装器（wrapper）。生成的对象支持 <code>__getitem __()</code> 和 <code>__iter __()</code> 迭代样式，以与 Python 2.1 和 Jython 兼容。当对象被迭代时，可选的 <code>blksize</code> 参数将反复传递给类似文件的对象的 <code>read()</code> 方法，以获取要产生的字节串。当 <code>read()</code> 返回一个空字节串时，迭代结束且不可恢复。如果 filelike 具有 <code>close</code> 方法，则返回的对象也将具有 <code>close</code> 方法，并且在调用时将调用该 Filelike 对象的 <code>close</code> 方法。</li>
</ul>
<p>用法示例：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> io <span class="token keyword">import</span> StringIO
<span class="token keyword">from</span> wsgiref<span class="token punctuation">.</span>util <span class="token keyword">import</span> FileWrapper

<span class="token comment"># We're using a StringIO-buffer for as the file-like object</span>
filelike <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token string">"This is an example file-like object"</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span>
wrapper <span class="token operator">=</span> FileWrapper<span class="token punctuation">(</span>filelike<span class="token punctuation">,</span> blksize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> chunk <span class="token keyword">in</span> wrapper<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h3 id="应用-框架端"><a href="#应用-框架端" class="headerlink" title="应用/框架端"></a>应用/框架端</h3><p>应用对象（application object）就是一个简单的接受两个参数的可调用对象。不要混淆术语”object”就真的是一个对象实例。Python 中的函数、方法、类、实现了 <code>__call__</code> 的实例都是可以接受的应用对象。应用对象必须可以被多次调用，因为实际上所有服务器/网关（除了 CGI 网关）都会重复地调用它。</p>
<p>注意：我们总是讲 应用对象，不要误解为应用开发者需要使用 WSGI 作为 web 编程 API！应用开发者可以继续使用已经存在的、高级框架服务去开发他们的应用。WSGI 是一个为框架开发者和服务器开发者准备的工具，应用开发者不需要直接使用 WSGI。</p>
<p>应用对象必须：</p>
<ol>
<li>accept two positional parameters:<ul>
<li>A dictionary containing CGI like variables; and</li>
<li>a callback function that will be used by the application to send HTTP status code/message and HTTP headers to the server.</li>
</ul>
</li>
<li>return the response body to the server as strings wrapped in an iterable.</li>
</ol>
<p>比如：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">simple_app</span><span class="token punctuation">(</span>environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""最简单的应用对象
    参数
    =======
    environ: 指向包含类似于 CGI 的环境变量的字典，该字典由服务器针对客户端收到的每个请求填充
    start_response: 服务器提供的回调函数，它以 HTTP 状态和标头为参数
    """</span>
    <span class="token comment"># 使用提供的 environ 字典构建响应主体</span>
    response_body <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'Request method: </span><span class="token interpolation"><span class="token punctuation">{</span>environ<span class="token punctuation">[</span><span class="token string">"REQUEST_METHOD"</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span>
    <span class="token comment"># HTTP 响应代码和消息</span>
    status <span class="token operator">=</span> <span class="token string">'200 OK'</span>
    <span class="token comment"># 客户端期望的 HTTP 标头必须将它们包装为元组对的列表：[(Header name, Header value)]</span>
    response_headers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">(</span><span class="token string">'Content-Length'</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>response_body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># 使用提供的函数将它们发送到服务器</span>
    start_response<span class="token punctuation">(</span>status<span class="token punctuation">,</span> response_headers<span class="token punctuation">)</span>
    <span class="token comment"># 返回响应主体。请注意，尽管它可以迭代，但它包装在列表中。</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>response_body<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>下面是两个应用对象(application object)的示例。一个是函数(function)，一个是类(class)：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">HELLO_WORLD <span class="token operator">=</span> <span class="token string">b"Hello world!\n"</span>


<span class="token keyword">def</span> <span class="token function">simple_app</span><span class="token punctuation">(</span>environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""最简单的应用对象"""</span>
    status <span class="token operator">=</span> <span class="token string">'200 OK'</span>
    response_headers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    start_response<span class="token punctuation">(</span>status<span class="token punctuation">,</span> response_headers<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>HELLO_WORLD<span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">AppClass</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""产生相同的输出，但是用类实现。

    (Note: 'AppClass' is the "application" here, so calling it
    returns an instance of 'AppClass', which is then the iterable
    return value of the "application callable" as required by
    the spec.

    If we wanted to use *instances* of 'AppClass' as application
    objects instead, we would have to implement a '__call__'
    method, which would be invoked to execute the application,
    and we would need to create an instance for use by the
    server or gateway.
    """</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>environ <span class="token operator">=</span> environ
        self<span class="token punctuation">.</span>start <span class="token operator">=</span> start_response

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        status <span class="token operator">=</span> <span class="token string">'200 OK'</span>
        response_headers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>start<span class="token punctuation">(</span>status<span class="token punctuation">,</span> response_headers<span class="token punctuation">)</span>
        <span class="token keyword">yield</span> HELLO_WORLD<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="服务器-网关端"><a href="#服务器-网关端" class="headerlink" title="服务器/网关端"></a>服务器/网关端</h2><p>服务器或者网关每次从 HTTP 客户端收到一个请求，就调用一次应用对象。为了描述方便，以下是一个简单的 CGI 网关，用 Python 函数实现，接收应用对象。注意这个简单的示例在错误处理方面相当简单，因为默认情况下，未捕获的异常会被 <code>dump</code> 到 <code>sys.stderr</code>，并且被 Web 服务器记入日志。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

enc<span class="token punctuation">,</span> esc <span class="token operator">=</span> sys<span class="token punctuation">.</span>getfilesystemencoding<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'surrogateescape'</span>


<span class="token keyword">def</span> <span class="token function">unicode_to_wsgi</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Convert an environment variable to a WSGI "bytes-as-unicode" string</span>
    <span class="token keyword">return</span> u<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>enc<span class="token punctuation">,</span> esc<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'iso-8859-1'</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">wsgi_to_bytes</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'iso-8859-1'</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">run_with_cgi</span><span class="token punctuation">(</span>application<span class="token punctuation">)</span><span class="token punctuation">:</span>
    environ <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span> unicode_to_wsgi<span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    environ<span class="token punctuation">[</span><span class="token string">'wsgi.input'</span><span class="token punctuation">]</span> <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token builtin">buffer</span>
    environ<span class="token punctuation">[</span><span class="token string">'wsgi.errors'</span><span class="token punctuation">]</span> <span class="token operator">=</span> sys<span class="token punctuation">.</span>stderr
    environ<span class="token punctuation">[</span><span class="token string">'wsgi.version'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    environ<span class="token punctuation">[</span><span class="token string">'wsgi.multithread'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
    environ<span class="token punctuation">[</span><span class="token string">'wsgi.multiprocess'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
    environ<span class="token punctuation">[</span><span class="token string">'wsgi.run_once'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>

    <span class="token keyword">if</span> environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'HTTPS'</span><span class="token punctuation">,</span> <span class="token string">'off'</span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'on'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        environ<span class="token punctuation">[</span><span class="token string">'wsgi.url_scheme'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'https'</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        environ<span class="token punctuation">[</span><span class="token string">'wsgi.url_scheme'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'http'</span>

    headers_set <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    headers_sent <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        out <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token builtin">buffer</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> headers_set<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> AssertionError<span class="token punctuation">(</span><span class="token string">"write() before start_response()"</span><span class="token punctuation">)</span>

        <span class="token keyword">elif</span> <span class="token keyword">not</span> headers_sent<span class="token punctuation">:</span>
            <span class="token comment"># Before the first output, send the stored headers</span>
            status<span class="token punctuation">,</span> response_headers <span class="token operator">=</span> headers_sent<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> headers_set
            out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>wsgi_to_bytes<span class="token punctuation">(</span><span class="token string">'Status: %s\r\n'</span> <span class="token operator">%</span> status<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> header <span class="token keyword">in</span> response_headers<span class="token punctuation">:</span>
                out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>wsgi_to_bytes<span class="token punctuation">(</span><span class="token string">'%s: %s\r\n'</span> <span class="token operator">%</span> header<span class="token punctuation">)</span><span class="token punctuation">)</span>
            out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>wsgi_to_bytes<span class="token punctuation">(</span><span class="token string">'\r\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        out<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">start_response</span><span class="token punctuation">(</span>status<span class="token punctuation">,</span> response_headers<span class="token punctuation">,</span> exc_info<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> exc_info<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> headers_sent<span class="token punctuation">:</span>
                    <span class="token comment"># Re-raise original exception if headers sent</span>
                    <span class="token keyword">raise</span> exc_info<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>with_traceback<span class="token punctuation">(</span>exc_info<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">finally</span><span class="token punctuation">:</span>
                exc_info <span class="token operator">=</span> <span class="token boolean">None</span>     <span class="token comment"># avoid dangling circular ref</span>
        <span class="token keyword">elif</span> headers_set<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> AssertionError<span class="token punctuation">(</span><span class="token string">"Headers already set!"</span><span class="token punctuation">)</span>

        headers_set<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>status<span class="token punctuation">,</span> response_headers<span class="token punctuation">]</span>

        <span class="token comment"># Note: error checking on the headers should happen here,</span>
        <span class="token comment"># *after* the headers are set.  That way, if an error</span>
        <span class="token comment"># occurs, start_response can only be re-called with</span>
        <span class="token comment"># exc_info set.</span>

        <span class="token keyword">return</span> write

    result <span class="token operator">=</span> application<span class="token punctuation">(</span>environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> data <span class="token keyword">in</span> result<span class="token punctuation">:</span>
            <span class="token keyword">if</span> data<span class="token punctuation">:</span>    <span class="token comment"># don't send headers until body appears</span>
                write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> headers_sent<span class="token punctuation">:</span>
            write<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>   <span class="token comment"># send headers now if body was empty</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            result<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="wsgiref-headers-–-WSGI-response-header-tools"><a href="#wsgiref-headers-–-WSGI-response-header-tools" class="headerlink" title="wsgiref.headers – WSGI response header tools"></a><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.10/library/wsgiref.html#module-wsgiref.headers">wsgiref.headers</a> – WSGI response header tools</h2><p>该模块提供了一个单独的类 <code>Headers</code>，用于使用类似于映射的接口方便地操作 WSGI 响应标头。</p>
<p><code>class wsgiref.headers.Headers([headers])</code>：创建一个类似于映射的对象来包装响应的 headers，该标头必须是如 PEP 3333 中所述的标头 <strong>名称/值</strong> 元组的列表。标头的默认值为空列表。标头对象支持典型的映射操作，包括 <code>__getitem__()</code>, <code>get()</code>, <code>__setitem__()</code>, <code>setdefault()</code>, <code>__delitem__()</code> 和 <code>__contains__()</code>。对于这些方法中的每一个，键都是标头名称（不区分大小写地对待），并且值是与该标头名称关联的第一个值。设置 header 会删除该 header 的所有现有值，然后在包装的 header 列表的末尾添加一个新值。通常保留 header 的现有顺序，将新的 header 添加到包装列表的末尾。</p>
<p>与字典不同，当您尝试获取或删除包装的标头列表中没有的键时，标头对象不会引发错误。获取不存在的标头只会返回 <code>None</code>，而删除不存在的标头则不会执行任何操作。</p>
<p><code>Headers</code> 对象还支持 <code>keys</code>，<code>values</code> 和 <code>items</code> 方法。如果存在多值标头，则 <code>keys</code> 和 <code>items</code> 方法返回的列表可以多次包含同一个键。<code>Headers</code> 对象的 <code>len</code> 方法与其 <code>items</code> 方法的长度相同，也与包装的 haeder 列表的长度相同。实际上，<code>items</code> 方法仅返回包装的 header 列表的副本。</p>
<p>在 <code>Headers</code> 对象上调用 <code>bytes()</code> 返回适合于作为 HTTP 响应标头传输的格式化字节串。每个标头均以其值放在一行中，并用冒号和空格分隔。每行以回车和换行符结尾，字节串以空行结尾。</p>
<p>除了其映射接口和格式设置功能之外，<code>Headers</code> 对象还具有以下方法用于查询和添加多值标头以及添加带有 MIME 参数的标头：</p>
<ul>
<li><code>get_all(name)</code>：返回命名标头的所有值的列表。返回的列表将按照它们在原始 header 列表中出现或添加到此实例的顺序进行排序，并且可能包含重复项。删除并重新插入的所有字段始终附加到 header 列表中。如果不存在具有给定 <code>name</code> 的字段，则返回一个空列表。</li>
<li><code>add_header(name, value, **_params)</code>：添加一个（可能是多值的）header，并通过关键字参数指定可选的 MIME 参数。<code>name</code> 是要添加的 header 字段。关键字参数可用于设置标头字段的 MIME 参数。每个参数必须是字符串或 <code>None</code>。参数名称中的下划线会转换为破折号，因为破折号在 Python 标识符中是非法的，但是许多 MIME 参数名称都包含破折号。如果参数值是字符串，则以 <code>name="value"</code> 的形式将其添加到标头值参数中。如果为 <code>None</code>，则仅添加参数名称。（这用于没有值的 MIME 参数。）用法示例：</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">h<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span><span class="token string">'content-disposition'</span><span class="token punctuation">,</span> <span class="token string">'attachment'</span><span class="token punctuation">,</span> filename<span class="token operator">=</span><span class="token string">'bud.gif'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面将添加一个 header，如下所示：</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html">Content-Disposition: attachment; filename="bud.gif"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h2 id="wsgiref-simple-server-–-a-simple-WSGI-HTTP-server"><a href="#wsgiref-simple-server-–-a-simple-WSGI-HTTP-server" class="headerlink" title="wsgiref.simple_server – a simple WSGI HTTP server"></a><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.10/library/wsgiref.html#module-wsgiref.simple_server">wsgiref.simple_server</a> – a simple WSGI HTTP server</h2><p>该模块实现了一个简单的 HTTP 服务器（基于 <code>http.server</code>），该服务器为 WSGI 应用程序服务。每个服务器实例在给定的主机和端口上服务单个 WSGI 应用程序。</p>
<p>用法示例：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> wsgiref<span class="token punctuation">.</span>simple_server <span class="token keyword">import</span> make_server<span class="token punctuation">,</span> demo_app

port <span class="token operator">=</span> <span class="token number">8000</span>  <span class="token comment"># 端口号</span>
host <span class="token operator">=</span> <span class="token string">''</span> <span class="token comment"># IP 地址</span>
<span class="token comment"># demo_app 是 处理函数</span>
<span class="token comment"># 创建一个服务器</span>
<span class="token keyword">with</span> make_server<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> demo_app<span class="token punctuation">)</span> <span class="token keyword">as</span> httpd<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"在端口 </span><span class="token interpolation"><span class="token punctuation">{</span>port<span class="token punctuation">}</span></span><span class="token string"> 上提供 HTTP 服务..."</span></span><span class="token punctuation">)</span>
    <span class="token comment"># 开始监听 HTTP 请求，响应请求直到进程终止</span>
    httpd<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 备选方案：处理一个请求，然后退出</span>
    httpd<span class="token punctuation">.</span>handle_request<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>下面详细说明此示例。</p>
<p><code>wsgiref.simple_server.make_server(host, port, app, server_class=WSGIServer, handler_class=WSGIRequestHandler)</code> 创建一个侦听 <code>host</code> 和 <code>port</code> 的新 WSGI 服务器，接受 <code>app</code> 的连接。返回值是提供的 <code>server_class</code> 的实例，并将使用指定的 <code>handler_class</code> 处理请求。<code>app</code> 必须是 PEP 3333 定义的 WSGI 应用程序对象。</p>
<p><code>wsgiref.simple_server.demo_app(environ, start_response)</code>：该函数是一个小型但完整的 WSGI 应用程序，它返回一个包含消息 <code>"Hello world!"</code> 的文本页面。以及 <code>environ</code> 参数中提供的键/值对的列表。这对于验证 WSGI 服务器（例如 <code>wsgiref.simple_server</code>）是否能够正确运行简单的 WSGI 应用程序很有用。</p>
<p><code>class wsgiref.simple_server.WSGIServer(server_address, RequestHandlerClass)</code> 创建一个 <code>WSGIServer</code> 实例。<code>server_address</code> 应该是一个 <code>(host,port)</code> 元组，而 <code>RequestHandlerClass</code> 应该是将用于处理请求的 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.10/library/http.server.html#http.server.BaseHTTPRequestHandler">http.server.BaseHTTPRequestHandler</a> 的子类。通常不需要调用此构造函数，因为 <code>make_server</code> 函数可以为您处理所有详细信息。<code>WSGIServer</code> 是 <code>http.server.HTTPServer</code> 的子类，因此它的所有方法（例如 <code>serve_forever</code> 和<code>handle_request</code>）都可用。<code>WSGIServer</code> 还提供以下特定于 WSGI 的方法：</p>
<ul>
<li><code>set_app(application)</code>：将可调用的应用程序设置为将接收请求的 WSGI 应用程序。</li>
<li><code>get_app()</code>：返回当前设置的可调用应用程序。</li>
</ul>
<p>但是，通常不需要使用这些其他方法，因为 <code>set_app</code> 通常由 <code>make_server</code> 调用，而 <code>get_app</code> 主要是为了请求处理程序实例而存在。</p>
<p><code>class wsgiref.simple_server.WSGIRequestHandler(request, client_address, server)</code> 为给定 <code>request</code>（即 <code>socket</code>），<code>client_address</code>（<code>(host,port)</code> 元组）和 <code>server</code>（<code>WSGIServer</code> 实例）创建 HTTP handler。您无需直接创建此类的实例； 它们由 <code>WSGIServer</code> 对象根据需要自动创建。但是，您可以将该类作为子类，并将其作为 <code>handler_class</code> 提供给 <code>make_server</code> 函数。在子类中重写的一些可能相关的方法：</p>
<ul>
<li><code>get_environ()</code>：返回包含请求的 WSGI 环境的字典。缺省实现复制 WSGIServer 对象的 <code>base_environ</code> 词典属性的内容，然后添加从 HTTP 请求派生的各种标头。每次对此方法的调用都应返回一个新字典，其中包含 PEP 3333 中指定的所有相关 CGI 环境变量。</li>
<li><code>get_stderr()</code> 返回应该用作 <code>wsgi.errors</code> 流的对象。默认实现只是返回 <code>sys.stderr</code>。</li>
<li><code>handle()</code> 处理 HTTP 请求。缺省实现使用 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.10/library/wsgiref.html#module-wsgiref.handlers"><code>wsgiref.handlers</code></a> 类创建一个处理程序实例，以实现实际的 WSGI 应用程序接口。</li>
</ul>
<h2 id="中间件：可以与两端交互的组件"><a href="#中间件：可以与两端交互的组件" class="headerlink" title="中间件：可以与两端交互的组件"></a>中间件：可以与两端交互的组件</h2><p>中间件（Middleware）就是一个简单对象：既可以作为服务端角色，响应应用对象；也可以作为应用对象，与服务器交互。除此之外，还有一些其他功能：</p>
<ul>
<li>重写 environ，然后基于 URL，将请求对象路由给不同的应用对象。</li>
<li>支持多个应用或者框架顺序地运行于同一个进程中。</li>
<li>通过转发请求和响应，支持负载均衡和远程处理。</li>
<li>支持对内容做后处理(postprocessing)，比如处理一个 XSL 样式表文件。</li>
</ul>
<p>中间件的灵魂是：对 WSGI 接口的服务器/网关端和 应用/框架端是透明的，不需要其他条件。</p>
<p>希望将中间件合并进应用的用户，将这个中间件传递给服务器即可，就好像这个中间件是一个应用对象；或者让中间件去调用应用对象，好像这个中间件就是服务器。当然，被中间件包装(wrap)的应用对象，实际上可能是另一个包装了另一个应用的中间件，以此类推，就创建了一个中间件栈（middleware stack）。</p>
<p>最重要的，中间件必须同时满足服务端和应用端的限制和条件。然而，在有些情况下，中间件需要的条件比单纯的服务端或者应用端更严格，这些点会在下面予以说明。</p>
<p>以下是一个中间件示例。他用 Joe Strout 的 <code>piglatin.py</code> 将 <code>text/plain</code> 的响应转换成 pig latin（注意：真正的中间件应该使用更加健壮的方式——应该检查内容的类型和内容的编码，同样这个简单的例子还忽略了一个单词可能被分割到一个块边界的可能性）。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> foo_app <span class="token keyword">import</span> foo_app
<span class="token keyword">from</span> piglatin <span class="token keyword">import</span> piglatin


<span class="token keyword">class</span> <span class="token class-name">LatinIter</span><span class="token punctuation">:</span>

    <span class="token triple-quoted-string string">"""Transform iterated output to piglatin, if it's okay to do so

    Note that the "okayness" can change until the application yields
    its first non-empty bytestring, so 'transform_ok' has to be a mutable
    truth value.
    """</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> result<span class="token punctuation">,</span> transform_ok<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">'close'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>close <span class="token operator">=</span> result<span class="token punctuation">.</span>close
        self<span class="token punctuation">.</span>_next <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span>__next__
        self<span class="token punctuation">.</span>transform_ok <span class="token operator">=</span> transform_ok

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__next__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>transform_ok<span class="token punctuation">:</span>
            <span class="token keyword">return</span> piglatin<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_next<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># call must be byte-safe on Py3</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_next<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Latinator</span><span class="token punctuation">:</span>

    <span class="token comment"># by default, don't transform output</span>
    transform <span class="token operator">=</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> application<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>application <span class="token operator">=</span> application

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token punctuation">:</span>

        transform_ok <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token keyword">def</span> <span class="token function">start_latin</span><span class="token punctuation">(</span>status<span class="token punctuation">,</span> response_headers<span class="token punctuation">,</span> exc_info<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

            <span class="token comment"># Reset ok flag, in case this is a repeat call</span>
            <span class="token keyword">del</span> transform_ok<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

            <span class="token keyword">for</span> name<span class="token punctuation">,</span> value <span class="token keyword">in</span> response_headers<span class="token punctuation">:</span>
                <span class="token keyword">if</span> name<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'content-type'</span> <span class="token keyword">and</span> value <span class="token operator">==</span> <span class="token string">'text/plain'</span><span class="token punctuation">:</span>
                    transform_ok<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
                    <span class="token comment"># Strip content-length if present, else it'll be wrong</span>
                    response_headers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
                                        <span class="token keyword">for</span> name<span class="token punctuation">,</span> value <span class="token keyword">in</span> response_headers
                                        <span class="token keyword">if</span> name<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'content-length'</span>
                                        <span class="token punctuation">]</span>
                    <span class="token keyword">break</span>

            write <span class="token operator">=</span> start_response<span class="token punctuation">(</span>status<span class="token punctuation">,</span> response_headers<span class="token punctuation">,</span> exc_info<span class="token punctuation">)</span>

            <span class="token keyword">if</span> transform_ok<span class="token punctuation">:</span>
                <span class="token keyword">def</span> <span class="token function">write_latin</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    write<span class="token punctuation">(</span>piglatin<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># call must be byte-safe on Py3</span>
                <span class="token keyword">return</span> write_latin
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> write

        <span class="token keyword">return</span> LatinIter<span class="token punctuation">(</span>self<span class="token punctuation">.</span>application<span class="token punctuation">(</span>environ<span class="token punctuation">,</span> start_latin<span class="token punctuation">)</span><span class="token punctuation">,</span> transform_ok<span class="token punctuation">)</span>


<span class="token comment"># Run foo_app under a Latinator's control, using the example CGI gateway</span>
run_with_cgi<span class="token punctuation">(</span>Latinator<span class="token punctuation">(</span>foo_app<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="wsgiref-validate-—-WSGI-conformance-checker"><a href="#wsgiref-validate-—-WSGI-conformance-checker" class="headerlink" title="wsgiref.validate — WSGI conformance checker"></a><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.10/library/wsgiref.html#module-wsgiref.validate">wsgiref.validate</a> — WSGI conformance checker</h2><p>创建新的 WSGI 应用程序对象，框架，服务器或中间件（middleware）时，使用 <code>wsgiref.validate</code> 验证新代码的一致性可能很有用。该模块提供了创建 WSGI 应用程序对象的函数，该函数验证 WSGI 服务器或网关与 WSGI 应用程序对象之间的通信，以检查双方的协议一致性。</p>
<p>请注意，该实用程序不能保证完全符合 PEP 3333；该模块中没有错误并不一定意味着不存在错误。但是，如果此模块确实产生错误，则实际上可以确定服务器或应用程序不是 $100%$ 兼容的。</p>
<p>该模块基于 Ian Bicking 的“Python Paste”库中的 <code>paste.lint</code> 模块。</p>
<p><code>wsgiref.validate.validator(application)</code> 包装应用程序并返回一个新的 WSGI 应用程序对象。返回的应用程序会将所有请求转发到原始应用程序，并将检查该应用程序和调用它的服务器是否都符合 WSGI 规范和 RFC 2616。</p>
<p>任何检测到的不符合都会导致引发 <code>AssertionError</code>；但是请注意，如何处理这些错误取决于服务器。例如，<code>wsgiref.simple_server</code> 和其他基于 <code>wsgiref.handlers</code> 的服务器（不会重写错误处理方法以执行其他操作）将仅输出一条消息，指出发生了错误，并将回溯信息转储到 <code>sys.stderr</code> 或其他错误流。</p>
<p>该包装器还可以使用 <a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.10/library/warnings.html#module-warnings"><code>warnings</code></a> 模块生成输出，以指示可疑的行为，但实际上可能不会被 PEP 3333 禁止。除非使用 Python 命令行选项或警告 API 禁止它们，否则任何此类警告都会写入 <code>sys.stderr</code>（不是 <code>wsgi.errors</code>，除非它们恰好是同一对象）。</p>
<p>用法示例：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> wsgiref<span class="token punctuation">.</span>validate <span class="token keyword">import</span> validator
<span class="token keyword">from</span> wsgiref<span class="token punctuation">.</span>simple_server <span class="token keyword">import</span> make_server

<span class="token comment"># Our callable object which is intentionally not compliant to the</span>
<span class="token comment"># standard, so the validator is going to break</span>
<span class="token keyword">def</span> <span class="token function">simple_app</span><span class="token punctuation">(</span>environ<span class="token punctuation">,</span> start_response<span class="token punctuation">)</span><span class="token punctuation">:</span>
    status <span class="token operator">=</span> <span class="token string">'200 OK'</span>  <span class="token comment"># HTTP Status</span>
    headers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Content-type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># HTTP Headers</span>
    start_response<span class="token punctuation">(</span>status<span class="token punctuation">,</span> headers<span class="token punctuation">)</span>

    <span class="token comment"># This is going to break because we need to return a list, and</span>
    <span class="token comment"># the validator is going to inform us</span>
    <span class="token keyword">return</span> <span class="token string">b"Hello World"</span>

<span class="token comment"># This is the application wrapped in a validator</span>
validator_app <span class="token operator">=</span> validator<span class="token punctuation">(</span>simple_app<span class="token punctuation">)</span>

<span class="token keyword">with</span> make_server<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">,</span> validator_app<span class="token punctuation">)</span> <span class="token keyword">as</span> httpd<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Listening on port 8000...."</span><span class="token punctuation">)</span>
    httpd<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="wsgiref-handlers-–-server-gateway-base-classes"><a href="#wsgiref-handlers-–-server-gateway-base-classes" class="headerlink" title="wsgiref.handlers – server/gateway base classes"></a><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.10/library/wsgiref.html#module-wsgiref.handlers">wsgiref.handlers</a> – server/gateway base classes</h2><p>该模块提供用于实现 WSGI 服务器和网关的基本处理程序类。这些基类可以处理与 WSGI 应用程序进行通信的大部分工作，只要它们具有类似 CGI 的环境以及输入，输出和错误流即可。</p>

        
    </div>
    <hr/>

    

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/dao/about" rel="external nofollow noreferrer">xinetzone</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://xinetzone.github.io/dao/post/zh-CN/22add8d782c9.html">https://xinetzone.github.io/dao/post/zh-CN/22add8d782c9.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特别声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/dao/about" target="_blank">xinetzone</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



    <div class="tag_share" style="display: block;">
        <div class="post-meta__tag-list" style="display: inline-block;">
    
        <div class="article-tag">
            
                <a href="/dao/tags/WSGI/">
                    <span class="chip bg-color">WSGI</span>
                </a>
            
        </div>
    
</div>
<div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
    <link rel="stylesheet" type="text/css" href="/dao/libs/share/css/share.min.css">
<div id="article-share">
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/dao/libs/share/js/social-share.min.js"></script>
    

    
</div>

</div>
    </div>
    
        <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/dao/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/dao/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

    
</div>
    </div>
    
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<link rel="stylesheet" href="/dao/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '',
        clientSecret: '',
        repo: 'dao',
        owner: 'xinetzone',
        admin: ["xinetzone"],
        id: '2021-03-08T14-07-37',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

















    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一页</div>
            <div class="card">
                <a href="/dao/post/zh-CN/d7d438b25c12.html">
                    <div class="card-image">
                        
                        
                        <img src="/dao/medias/featureimages/9.jpg" class="responsive-img" alt="WSGI 编程">
                        
                        <span class="card-title">WSGI 编程</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-03-09
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/dao/categories/%E6%95%99%E7%A8%8B/" class="post-category">
                                    教程
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/dao/tags/WSGI/">
                        <span class="chip bg-color">WSGI</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一页&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/dao/post/zh-CN/8a7367c4d509.html">
                    <div class="card-image">
                        
                        
                        <img src="/dao/medias/featureimages/5.jpg" class="responsive-img" alt="Python Common Gateway Interface support">
                        
                        <span class="card-title">Python Common Gateway Interface support</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-02-19
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/dao/categories/%E6%89%8B%E5%86%8C/" class="post-category">
                                    手册
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/dao/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                    <a href="/dao/tags/cgi/">
                        <span class="chip bg-color">cgi</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



    <!-- 是否加载使用自带的 prismjs. -->
    <link rel="stylesheet" href="/dao/libs/prism/prism.css">
    

    

<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/dao/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/dao/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/dao/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/dao/libs/codeBlock/codeShrink.js"></script>



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
      integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script type="module">
    import renderMathInElement from "https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.mjs";
    let options = {
        delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "$", right: "$", display: false },
            { left: "\\(", right: "\\)", display: false },
            { left: "\\[", right: "\\]", display: true }
        ],
        leqno: true
    }
    renderMathInElement(document.querySelector("body"), options)
</script>

    </div>
    <link rel="stylesheet" href="/dao/libs/tocbot/tocbot.css">

<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>

<div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
    <div class="toc-widget card" style="background-color: white;">
        <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
        <div id="toc-content"></div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

    <div id="floating-toc-btn" class="hide-on-med-and-down">
        <a class="btn-floating btn-large bg-color">
            <i class="fas fa-list-ul"></i>
        </a>
    </div>


<script src="/dao/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    
            
            /* 修复文章卡片 div 的宽度. */
            let fixPostCardWidth = function (srcId, targetId) {
                let srcDiv = $('#' + srcId);
                if (srcDiv.length === 0) {
                    return;
                }

                let w = srcDiv.width();
                if (w >= 450) {
                    w = w + 21;
                } else if (w >= 350 && w < 450) {
                    w = w + 18;
                } else if (w >= 300 && w < 350) {
                    w = w + 16;
                } else {
                    w = w + 14;
                }
                $('#' + targetId).width(w);
            };

            // 切换TOC目录展开收缩的相关操作.
            const expandedClass = 'expanded';
            let $tocAside = $('#toc-aside');
            let $mainContent = $('#main-content');
            $('#floating-toc-btn .btn-floating').click(function () {
                if ($tocAside.hasClass(expandedClass)) {
                    $tocAside.removeClass(expandedClass).hide();
                    $mainContent.removeClass('l9');
                } else {
                    $tocAside.addClass(expandedClass).show();
                    $mainContent.addClass('l9');
                }
                fixPostCardWidth('artDetail', 'prenext-posts');
            });
            
        });
</script>
</div>

    
</main>


    <footer class="page-footer bg-color">
    
        <style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }
    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }
    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }
    
</style>
<div class="wyya">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css" 
        integrity="sha512-CIYsJUa3pr1eoXlZFroEI0mq0UIMUqNouNinjpCkSWo3Bx5NRlQ0OuC6DtEB/bDqUWnzXc1gs2X/g52l36N5iw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js" 
        integrity="sha512-RWosNnDNw8FxHibJqdFRySIswOUgYhFxnmYO3fp+BgCU7gfo4z0oS7mYFBvaa8qu+axY39BmQOrhW3Tp70XbaQ==" crossorigin="anonymous">
    </script>
    <!-- require MetingJS -->
    <script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    <div class="">
        
        <div class="row">
            <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                       server="netease"
                       type="playlist"
                       id="503838841"
                       fixed='true'
                       autoplay='false'
                       theme='#42b983'
                       loop='all'
                       order='random'
                       preload='auto'
                       volume='0.7'
                       list-folded='true'>
            </meting-js>
        </div>
    </div>
</div>
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2021</span>
            
            <span id="year">2019</span>
            <a href="/dao/about" target="_blank">xinetzone</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/xinetzone/matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">119.9k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "7";
                    var startDate = "1";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/xinetzone" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:q735613050@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=735613050" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 735613050" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>





    <a href="https://www.zhihu.com/people/liu-xin-wei-55" class="tooltipped" target="_blank" data-tooltip="关注我的知乎: liu-xin-wei-55" data-position="top" data-delay="50">
        <i class="fab fa-zhihu1">知</i>
    </a>



    <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/xinet" class="tooltipped" data-tooltip="领英联系我: xinet" data-position="top" data-delay="50">
        <i class="fab fa-linkedin"></i>
    </a>



    <a href="/dao/rss2.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/dao/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>

    <script src="/dao/libs/materialize/materialize.min.js"></script>
    <script src="/dao/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/dao/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/dao/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/dao/js/matery.js"></script>
    
    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/dao/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/dao/libs/others/busuanzi.pure.mini.js"></script>






<!--腾讯兔小巢-->








<script src="/dao/libs/instantpage/instantpage.js" type="module"></script>

</body>

</html>
